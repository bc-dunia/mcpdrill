{
  "schema_version": "run-config/v1",
  "scenario_id": "stream-stall-test",
  "metadata": {
    "name": "Stream Stall Detection Test",
    "description": "Tests stream stall detection by using aggressive timeouts. Designed to trigger stall detection when streams stop producing events.",
    "created_by": "mcpdrill-templates",
    "tags": {
      "type": "streaming",
      "workload": "stall-detection",
      "transport": "sse"
    }
  },
  "target": {
    "kind": "server",
    "url": "http://localhost:9000",
    "transport": "streamable_http",
    "headers": {},
    "auth": {
      "type": "none"
    },
    "identification": {
      "run_id_header": {
        "name": "X-MCPDrill-Run-ID",
        "value_template": "{{.RunID}}"
      },
      "user_agent": {
        "value": "MCPDrill/1.0 (Stream-Stall-Test)"
      }
    },
    "timeouts": {
      "connect_timeout_ms": 5000,
      "request_timeout_ms": 120000,
      "stream_stall_timeout_ms": 10000
    },
    "tls": {
      "verify": true,
      "ca_bundle_ref": null
    },
    "redirect_policy": {
      "mode": "deny",
      "max_redirects": 0
    }
  },
  "environment": {
    "allowlist": {
      "mode": "deny_by_default",
      "allowed_targets": [
        {
          "kind": "exact",
          "value": "http://localhost:9000"
        }
      ]
    },
    "forbidden_patterns": []
  },
  "session_policy": {
    "mode": "reuse",
    "pool_size": null,
    "ttl_ms": 300000,
    "max_idle_ms": 60000,
    "churn_interval_ops": null
  },
  "workload": {
    "in_flight_per_vu": 1,
    "think_time": {
      "mode": "fixed",
      "base_ms": 1000,
      "jitter_ms": 0
    },
    "operation_mix": [
      {
        "operation": "tools_call",
        "weight": 100
      }
    ],
    "tools": {
      "selection": {
        "mode": "single",
        "single_template_id": "slow-stream"
      },
      "templates": [
        {
          "template_id": "slow-stream",
          "tool_name": "notifications_subscribe",
          "weight": 1,
          "arguments": {
            "event_count": 5,
            "interval_ms": 15000
          },
          "expects_streaming": true
        }
      ]
    },
    "payload_profiles": []
  },
  "stages": [
    {
      "stage_id": "stg_0000000000000001",
      "stage": "preflight",
      "enabled": true,
      "duration_ms": 5000,
      "max_duration_ms": null,
      "load": {
        "target_vus": 1,
        "target_rps": null
      },
      "ramp": null,
      "stop_conditions": []
    },
    {
      "stage_id": "stg_0000000000000002",
      "stage": "baseline",
      "enabled": true,
      "duration_ms": 60000,
      "max_duration_ms": 120000,
      "load": {
        "target_vus": 10,
        "target_rps": null
      },
      "ramp": null,
      "stop_conditions": [
        {
          "id": "stream-stalls-detected",
          "metric": "stream_stall_count",
          "comparator": ">=",
          "threshold": 5,
          "window_ms": 30000,
          "sustain_windows": 1,
          "scope": {}
        }
      ]
    }
  ],
  "safety": {
    "ramp_by_default": false,
    "emergency_stop_enabled": true,
    "identification_required": true,
    "worker_failure_policy": "fail_fast",
    "analysis_timeout_ms": 1800000,
    "hard_caps": {
      "max_vus": 50,
      "max_rps": 1000,
      "max_connections": 100,
      "max_duration_ms": 300000,
      "max_in_flight_per_vu": 5,
      "max_telemetry_q_depth": 50000
    },
    "stop_policy": {
      "mode": "immediate",
      "drain_timeout_ms": 0
    }
  },
  "reporting": {
    "formats": ["json", "html"],
    "retention": {
      "raw_logs_days": 7,
      "metrics_days": 30,
      "reports_days": 90
    },
    "include": {
      "store_raw_logs": true,
      "store_metrics_snapshot": true,
      "store_event_log": true
    },
    "redaction": {
      "redact_headers": ["Authorization", "Cookie", "X-API-Key"]
    }
  },
  "telemetry": {
    "structured_logs": {
      "enabled": true,
      "sample_rate": 1.0
    },
    "traces": {
      "enabled": false,
      "propagation": {
        "accept_incoming_traceparent": false
      }
    }
  }
}
